<fest:template xmlns:fest="http://fest.mail.ru" context_name="json">
  <div id="content">
    <div class="row">
      <div class="col-md-10">
        <div class="login">
          <form class="login-form form-inline" action="/signin" method="POST" name="ValidationForm" onsubmit="return checkForm()">
            <div class="form-group">
              <div class="input-group">
                <div class="input-group-addon">
                  <span class="glyphicon glyphicon-user"></span>
                </div>
                <input type="text" class="form-control" placeholder="Username" aria-describedby="sizing-addon1" id="username"></input>
              </div>
              <p class="help-block" id="userhelp"></p>
            </div>
            <div class="form-group">
              <div class="input-group">
                <div class="input-group-addon">
                  <span class="glyphicon glyphicon-envelope"></span>
                </div>
                <input type="email" class="form-control" placeholder="Email" aria-describedby="sizing-addon1" id="email"></input>
              </div>
              <p class="help-block" id="emailhelp"></p>
            </div>
            <div class="form-group">
              <div class="input-group">
                <div class="input-group-addon">
                  <span class="glyphicon glyphicon-lock"></span>
                </div>
                <input type="password" class="form-control" placeholder="Password" id="password" aria-describedby="sizing-addon1"></input>
              </div>
              <p class="help-block" id="passhelp"></p>
            </div>
            <p>
              <div class="btn-group btn-group-justified">
                <div class="btn-group">
                  <button type="submit" class="btn  btn-success">SignIn!</button>
                </div>
                <div class="btn-group">
                  <a id="backBtn" href="#main" class="btn btn-default">Back</a>
                </div>
              </div>
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>
<script type="text/javascript">
  <fest:cdata>
  <![CDATA[
  $("#password").on("change", checkPassword);
  $("#email").on("change", checkEmail);
  $("#username").on("change", checkUsername);
  function checkForm() {
    cu = checkUsername()
    ce = checkEmail()
    cp = checkPassword()
    return cu && ce && cp;
  }
  function checkPassword()
  { // at least one number, one lowercase and one uppercase letter
    // at least six characters
    var str = document.getElementById("password").value;
    var re = /(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;
    if(!re.test(str)) {
      $("#passhelp").html("Password should include "+
                          "at least one number, "+
                          "one lowercase and one uppercase letter "+
                          "and at least six characters");
      $("#password").css({"box-shadow":"0 0 2pt 1pt red"})
      return false;
    }
    $("#passhelp").empty()
    $("#password").css({"box-shadow":"0 0 2pt 1pt green"})
    return true;
  }
  function checkEmail(){
    var str = document.getElementById("email").value;

    if(str.search('@') <= 0) {
      $("#emailhelp").html("Email should contain @ character");
      $("#email").css({"box-shadow":"0 0 2pt 1pt red"});
      return false;
    }
    $("#emailhelp").empty()
    $("#email").css({"box-shadow":"0 0 2pt 1pt green"})
    return true
  }
  function checkUsername()
  {
    var str = document.getElementById("username").value;
    var reg1 = /^[a-zA-Z0-9]*$/
    var reg2 = /^[a-zA-Z0-9][a-zA-Z0-9]*$/
    if(!reg1.test(str)){
      $("#userhelp").html("Username can contain only letters or digits");
      $("#username").css({"box-shadow":"0 0 2pt 1pt red"});
      return false;
    } else if(!reg2.test(str)) {
      $("#userhelp").html("Username cannot be empty");
      $("#username").css({"box-shadow":"0 0 2pt 1pt red"});
      return false;
    } else {
      $("#userhelp").empty()
      $("#username").css({"box-shadow":"0 0 2pt 1pt green"})
      return true;
    }
  }
  ]]>
  </fest:cdata>
</script>
</fest:template>

